(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8224],{5602:(e,s,t)=>{Promise.resolve().then(t.bind(t,7787))},7787:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var l=t(8097),a=t(5806),r=t(5189),n=t(2085),i=t(3563);function c(){let[e,s]=(0,n.useState)(""),[t,c]=(0,n.useState)(null),[d,u]=(0,n.useState)([]),[o,m]=(0,n.useState)(!1),[h,x]=(0,n.useState)(null),p=(0,n.useRef)(null);async function b(){let e=(await i.G.bulkJobs.list()).map(e=>({id:String(e.id),status:String(e.status),result_url:e.result_url}));return u(e),e}(0,n.useEffect)(()=>(b(),()=>{p.current&&clearInterval(p.current)}),[]);let f=async()=>{if(!t)return void x("Please choose a file");m(!0),x(null);try{let e=await i.G.files.upload(t);if(!e.success)throw Error("Upload failed");await i.G.bulkJobs.create(e.url),x("Job started. Tracking progress…"),await b(),p.current||(p.current=setInterval(async()=>{!(await b()).some(e=>"completed"!==e.status)&&p.current&&(clearInterval(p.current),p.current=null)},2e3))}catch(e){x(e.message)}finally{m(!1)}},g=d.filter(e=>"completed"!==e.status).length;return(0,l.jsx)(a.A,{allowedRoles:["user"],children:(0,l.jsx)(r.A,{title:"Bulk Upload",subtitle:"Upload CSV/Excel for mass vendor verification and track job status",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,l.jsxs)("div",{className:"md:col-span-2 rounded-lg border border-neutral-200/70 bg-white/80 p-4",children:[(0,l.jsx)("p",{className:"text-sm",style:{fontFamily:"var(--font-geist)",fontWeight:600},children:"Upload file"}),(0,l.jsx)("p",{className:"text-xs text-neutral-600 mb-2",children:"CSV with columns: vendorName, gstin, pan, bankAccount, ifsc"}),(0,l.jsxs)("label",{className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border border-neutral-200/70 cursor-pointer bg-white/90",children:[(0,l.jsx)("input",{type:"file",className:"hidden",onChange:e=>{var t;let l=Array.from(null!=(t=e.target.files)?t:[])[0];c(null!=l?l:null),s((null==l?void 0:l.name)||"")}}),(0,l.jsx)("span",{children:"Choose File"})]}),e&&(0,l.jsxs)("p",{className:"text-xs mt-2",children:["Selected: ",e]}),(0,l.jsx)("div",{className:"mt-3",children:(0,l.jsx)("button",{disabled:o,onClick:f,className:"px-3 py-2 text-sm rounded-md text-white bg-orange-600 disabled:opacity-50",children:o?"Starting…":"Start Job"})}),h&&(0,l.jsx)("p",{className:"text-xs mt-2",children:h})]}),(0,l.jsxs)("div",{className:"rounded-lg border border-neutral-200/70 bg-white/80 p-4",children:[(0,l.jsx)("p",{className:"text-sm",style:{fontFamily:"var(--font-geist)",fontWeight:600},children:"Job status"}),g>0&&(0,l.jsx)("div",{className:"mt-2 w-full h-2 rounded bg-neutral-200 overflow-hidden","aria-label":"Progress bar",children:(0,l.jsx)("div",{className:"h-2 bg-orange-500 animate-pulse",style:{width:"66%"}})}),(0,l.jsxs)("ul",{className:"mt-2 space-y-1 text-sm",children:[d.map(e=>(0,l.jsxs)("li",{className:"flex items-center justify-between",children:[(0,l.jsxs)("span",{children:["Job ",e.id.slice(0,6)," • ",e.status]}),e.result_url&&(0,l.jsx)("a",{className:"underline",href:e.result_url,children:"Download"})]},e.id)),0===d.length&&(0,l.jsx)("li",{className:"text-neutral-500",children:"No jobs yet."})]})]})]})})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[9765,5366,1780,8292,7349,1958,7358],()=>s(5602)),_N_E=e.O()}]);